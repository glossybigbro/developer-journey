/**
 * ğŸŒŒ [WIDGET] SpaceBackground (ì§€ë¸Œë¦¬ ìŠ¤íƒ€ì¼ ìš°ì£¼ ë°°ê²½)
 * 
 * @layer shared/ui
 * @description
 * HTML Canvas APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ê·¸ë ¤ì§€ëŠ” ì¸í„°ë™í‹°ë¸Œ ìš°ì£¼ ë°°ê²½ì…ë‹ˆë‹¤.
 * ì§€ë¸Œë¦¬ ì• ë‹ˆë©”ì´ì…˜ì˜ ëª½í™˜ì ì¸ ëŠë‚Œì„ ì¬í˜„í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ë ˆì´ì–´ì˜ ë³„, ì€í•˜ìˆ˜, ìœ ì„±ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
 * 
 * ğŸ¨ ì‹œê°ì  íŠ¹ì§•:
 * - **3-Layer Stars**: í¬ê¸°ì™€ ì†ë„ê°€ ë‹¤ë¥¸ ë³„ë“¤ë¡œ ê¹Šì´ê°(Parallax) í‘œí˜„
 * - **Nebula Dust**: ëŒ€ê°ì„  ë  ëª¨ì–‘ì˜ ì€í•˜ìˆ˜ (800ê°œ íŒŒí‹°í´)
 * - **Shooting Stars**: ëœë¤í•˜ê²Œ ë‚˜íƒ€ë‚˜ëŠ” ìœ ì„± íš¨ê³¼
 * - **Color Palette**: ë³´ë¼-í•‘í¬-ì²­ë¡ ê·¸ë¼ë°ì´ì…˜ (ì§€ë¸Œë¦¬ ê°ì„±)
 * 
 * ğŸ—ï¸ ê¸°ìˆ  ìŠ¤íƒ:
 * - **Canvas 2D Context**: í”½ì…€ ë‹¨ìœ„ ì§ì ‘ ì œì–´
 * - **requestAnimationFrame**: 60fps ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜
 * - **Responsive Design**: ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìë™ ì¬ì¡°ì •
 * 
 * ğŸ“ [í•™ìŠµ ëª©í‘œ]:
 * 1. **Canvas API**: `arc()`, `fillRect()`, `createLinearGradient()` ë“± ê¸°ë³¸ ë„í˜• ê·¸ë¦¬ê¸°
 * 2. **Animation Loop**: `requestAnimationFrame`ì„ ì‚¬ìš©í•œ ê²Œì„ ë£¨í”„ êµ¬í˜„
 * 3. **Performance**: ìˆ˜ë°± ê°œì˜ ê°ì²´ë¥¼ ë§¤ í”„ë ˆì„ ë Œë”ë§í•˜ëŠ” ìµœì í™” ê¸°ë²•
 * 4. **Math Physics**: ì‚¼ê°í•¨ìˆ˜(`Math.sin`, `Math.cos`)ë¥¼ í™œìš©í•œ ìì—°ìŠ¤ëŸ¬ìš´ ì›€ì§ì„
 * 
 * ğŸ’¡ [ì„±ëŠ¥ ìµœì í™”]:
 * - ë³„ ìœ„ì¹˜ë¥¼ ë¹„ìœ¨(0~1)ë¡œ ì €ì¥í•˜ì—¬ ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì¬ê³„ì‚° ìµœì†Œí™”
 * - `globalAlpha`ë¡œ íˆ¬ëª…ë„ ì œì–´ (ë³„ë„ ì´ë¯¸ì§€ ì—†ì´ ê°€ë²¼ì›€)
 * - `shadowBlur`ëŠ” í° ë³„ì—ë§Œ ì„ íƒì  ì ìš©
 */

'use client'

import { useEffect, useRef } from 'react'
import styles from './SpaceBackground.module.css'
import type { Star, ShootingStar, NebulaDust } from '@/shared/types/ui'
import { SPACE_CONFIG } from '@/shared/config/ui-constants'

// ==========================================
// [Main Component] SpaceBackground
// ==========================================

/**
 * ğŸŒŸ SpaceBackground ì»´í¬ë„ŒíŠ¸
 * 
 * @description
 * Canvasë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ìš°ì£¼ ë°°ê²½ì„ ê·¸ë¦¬ëŠ” ë©”ì¸ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.
 */
export default function SpaceBackground() {
    // [Canvas Reference] DOM ìš”ì†Œ ì°¸ì¡°
    // useRefë¥¼ ì‚¬ìš©í•˜ì—¬ Canvas ì—˜ë¦¬ë¨¼íŠ¸ì— ì§ì ‘ ì ‘ê·¼í•©ë‹ˆë‹¤.
    const canvasRef = useRef<HTMLCanvasElement>(null)

    useEffect(() => {
        // ==========================================
        // [Canvas Setup] ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
        // ==========================================

        const canvas = canvasRef.current
        if (!canvas) return // Early return: Canvasê°€ ì•„ì§ ë§ˆìš´íŠ¸ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì¢…ë£Œ

        const ctx = canvas.getContext('2d')
        if (!ctx) return // Early return: 2D Contextë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìœ¼ë©´ ì¢…ë£Œ

        // ==========================================
        // [Nebula Dust] ì€í•˜ìˆ˜ ë¨¼ì§€ ìƒì„±
        // ==========================================
        // 
        // ğŸ¯ ëª©ì : ëŒ€ê°ì„  ë  ëª¨ì–‘ì˜ ì€í•˜ìˆ˜ë¥¼ 800ê°œì˜ íŒŒí‹°í´ë¡œ í‘œí˜„
        // 
        // ğŸ” ì•Œê³ ë¦¬ì¦˜:
        // 1. í™”ë©´ ì¤‘ì•™ì„ ê¸°ì¤€ìœ¼ë¡œ ëŒ€ê°ì„  ë ë¥¼ ì„¤ì •
        // 2. ë ì˜ ì¤‘ì‹¬ì—ì„œ ë©€ì–´ì§ˆìˆ˜ë¡ íŒŒí‹°í´ ë°€ë„ì™€ íˆ¬ëª…ë„ ê°ì†Œ
        // 3. ìì—°ìŠ¤ëŸ¬ìš´ ë¶„í¬ë¥¼ ìœ„í•´ ëœë¤ ì˜¤í”„ì…‹ ì¶”ê°€

        const nebulaDust: NebulaDust[] = []

        /**
         * ğŸŒ«ï¸ ì€í•˜ìˆ˜ ë¨¼ì§€ ìƒì„± í•¨ìˆ˜
         * 
         * @description
         * í™”ë©´ í¬ê¸°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ í˜¸ì¶œë˜ì–´ ì€í•˜ìˆ˜ íŒŒí‹°í´ì„ ì¬ìƒì„±í•©ë‹ˆë‹¤.
         * ëŒ€ê°ì„  ë  ëª¨ì–‘ì˜ ë¶„í¬ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ìˆ˜í•™ì  ê³„ì‚°ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
         */
        const createNebulaDust = () => {
            // ê¸°ì¡´ íŒŒí‹°í´ ì œê±° (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
            nebulaDust.length = 0

            // ë ì˜ ì¤‘ì‹¬ Y ì¢Œí‘œ (í™”ë©´ ì¤‘ì•™)
            const bandCenterY = canvas.height * 0.5
            // ë ì˜ í­ (í™”ë©´ ë†’ì´ì˜ 40%)
            const bandWidth = canvas.height * 0.4

            // 800ê°œì˜ íŒŒí‹°í´ ìƒì„±
            for (let i = 0; i < 800; i++) {
                // X ì¢Œí‘œ: í™”ë©´ ì „ì²´ì— ëœë¤ ë¶„í¬
                const x = Math.random() * canvas.width

                // Y ì˜¤í”„ì…‹: X ì¢Œí‘œì— ë¹„ë¡€í•˜ì—¬ ëŒ€ê°ì„  í˜•íƒœ ìƒì„±
                // 0.3ì€ ëŒ€ê°ì„ ì˜ ê¸°ìš¸ê¸° (ë‚®ì„ìˆ˜ë¡ ì™„ë§Œ, ë†’ì„ìˆ˜ë¡ ê°€íŒŒë¦„)
                const yOffset = x * 0.3

                // ëœë¤ Y ë³€ë™: ë  ì•ˆì—ì„œ ìì—°ìŠ¤ëŸ¬ìš´ ë¶„ì‚°
                const randomY = (Math.random() - 0.5) * bandWidth * 2

                // ìµœì¢… Y ì¢Œí‘œ
                const y = yOffset + randomY

                // ë ì˜ ì¤‘ì‹¬ìœ¼ë¡œë¶€í„°ì˜ ê±°ë¦¬ ê³„ì‚°
                const distanceFromCenter = Math.abs(yOffset + randomY - bandCenterY)

                // ë  ì•ˆì— ìˆëŠ” íŒŒí‹°í´ë§Œ ìƒì„±
                if (distanceFromCenter < bandWidth) {
                    // ë°€ë„ ê³„ì‚°: ì¤‘ì‹¬ì— ê°€ê¹Œìš¸ìˆ˜ë¡ 1ì— ê°€ê¹Œì›€
                    const densityFactor = 1 - (distanceFromCenter / bandWidth)

                    // íˆ¬ëª…ë„: ë°€ë„ì— ë¹„ë¡€ (ì¤‘ì‹¬ë¶€ê°€ ë” ë°ìŒ)
                    const opacity = Math.random() * 0.5 * densityFactor + 0.1

                    nebulaDust.push({
                        x: x,
                        y: y,
                        // í¬ê¸°: ë°€ë„ì— ë¹„ë¡€ (ì¤‘ì‹¬ë¶€ê°€ ë” í¼)
                        size: (Math.random() * 2.5 + 0.8) * densityFactor,
                        opacity: opacity,
                        color: `rgba(255, 255, 255, ${opacity})`,
                        // ì´ë™ ì†ë„: ì²œì²œíˆ ì™¼ìª½ ìœ„ë¡œ íë¦„
                        speedX: -0.08,
                        speedY: -0.024,
                        layer: 1
                    })
                }
            }
        }

        // ==========================================
        // [Responsive Canvas] ë°˜ì‘í˜• ìº”ë²„ìŠ¤ ì„¤ì •
        // ==========================================

        /**
         * ğŸ“ ìº”ë²„ìŠ¤ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ëŸ¬
         * 
         * @description
         * ìœˆë„ìš° í¬ê¸°ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ì¡°ì •í•˜ê³ 
         * ì€í•˜ìˆ˜ íŒŒí‹°í´ì„ ì¬ìƒì„±í•©ë‹ˆë‹¤.
         */
        const resizeCanvas = () => {
            canvas.width = window.innerWidth
            canvas.height = window.innerHeight

            // í•´ìƒë„ ë³€ê²½ ì‹œ ì€í•˜ìˆ˜ ì¬ìƒì„±
            createNebulaDust()
        }

        // ì´ˆê¸° ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
        resizeCanvas()

        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.addEventListener('resize', resizeCanvas)

        // ==========================================
        // [Star Generation] ë³„ ìƒì„± (3-Layer System)
        // ==========================================
        // 
        // ğŸ¯ ëª©ì : ê¹Šì´ê°(Parallax)ì„ ì£¼ê¸° ìœ„í•´ í¬ê¸°ì™€ ì†ë„ê°€ ë‹¤ë¥¸ 3ê°œ ë ˆì´ì–´ë¡œ ë³„ì„ ìƒì„±
        // 
        // ğŸŒŸ ë ˆì´ì–´ êµ¬ì¡°:
        // - Layer 1 (í° ë³„): 50ê°œ, í¬ê¸° 1.5~3.5px, ê°€ì¥ ë¹ ë¦„ (ê°€ê¹Œì´ ìˆëŠ” ëŠë‚Œ)
        // - Layer 2 (ì¤‘ê°„ ë³„): 100ê°œ, í¬ê¸° 0.8~2.3px, ì¤‘ê°„ ì†ë„
        // - Layer 3 (ì‘ì€ ë³„): 200ê°œ, í¬ê¸° 0.3~1.3px, ê°€ì¥ ëŠë¦¼ (ë©€ë¦¬ ìˆëŠ” ëŠë‚Œ)
        // 
        // ğŸ’¡ ìµœì í™” í¬ì¸íŠ¸:
        // - ë³„ ìœ„ì¹˜ë¥¼ ë¹„ìœ¨(0~1)ë¡œ ì €ì¥í•˜ì—¬ ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì¬ìƒì„± ë¶ˆí•„ìš”
        // - ì‹¤ì œ í”½ì…€ ì¢Œí‘œëŠ” ë Œë”ë§ ì‹œì ì— ê³„ì‚° (actualX = x * canvas.width)

        const stars: Star[] = []

        /**
         * â­ ë³„ ìƒì„± í•¨ìˆ˜
         * 
         * @description
         * 3ê°œì˜ ë ˆì´ì–´ë¡œ ë‚˜ëˆ„ì–´ ì´ 350ê°œì˜ ë³„ì„ ìƒì„±í•©ë‹ˆë‹¤.
         * ê° ë³„ì€ ê³ ìœ í•œ ìƒ‰ìƒ, í¬ê¸°, ë°˜ì§ì„ ì†ë„ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
         */
        const createStars = () => {
            // ==========================================
            // [Color Palette] ë³„ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
            // ==========================================
            // 
            // ì§€ë¸Œë¦¬ ì• ë‹ˆë©”ì´ì…˜ì˜ ë”°ëœ»í•˜ê³  ëª½í™˜ì ì¸ ëŠë‚Œì„ ì¬í˜„í•˜ê¸° ìœ„í•´
            // 6ê°€ì§€ ìƒ‰ìƒì„ ëœë¤í•˜ê²Œ ë°°ì •í•©ë‹ˆë‹¤.

            const starColors = [
                'rgba(255, 255, 255, 1)',   // í°ìƒ‰ (ê¸°ë³¸)
                'rgba(255, 240, 200, 1)',   // ë…¸ë€ë¹› (ë”°ëœ»í•¨)
                'rgba(200, 220, 255, 1)',   // íŒŒë€ë¹› (ì°¨ê°€ì›€)
                'rgba(255, 200, 150, 1)',   // ì£¼í™©ë¹› (í™œê¸°)
                'rgba(255, 220, 220, 1)',   // ë¶„í™ë¹› (ë¶€ë“œëŸ¬ì›€)
                'rgba(200, 255, 220, 1)',   // ì—°ë‘ë¹› (ì‹ ì„ í•¨)
            ]

            // ==========================================
            // Layer 1: í° ë³„ (50ê°œ)
            // ==========================================
            // 
            // ğŸ¨ íŠ¹ì§•:
            // - í¬ê¸°: 1.5 ~ 3.5px (ê°€ì¥ í¼)
            // - ë°˜ì§ì„ ì†ë„: 0.01 ~ 0.03 (ë¹ ë¦„)
            // - ê¸€ë¡œìš° íš¨ê³¼: íˆ¬ëª…ë„ 0.7 ì´ìƒì¼ ë•Œ ì ìš©

            for (let i = 0; i < 50; i++) {
                stars.push({
                    x: Math.random(), // 0-1 ë¹„ìœ¨ë¡œ ì €ì¥
                    y: Math.random(),
                    size: Math.random() * 2 + 1.5,
                    opacity: Math.random(),
                    twinkleSpeed: Math.random() * 0.02 + 0.01,
                    layer: 1,
                    color: starColors[Math.floor(Math.random() * starColors.length)],
                    pulsePhase: Math.random() * Math.PI * 2
                })
            }

            // ==========================================
            // Layer 2: ì¤‘ê°„ ë³„ (100ê°œ)
            // ==========================================
            // 
            // ğŸ¨ íŠ¹ì§•:
            // - í¬ê¸°: 0.8 ~ 2.3px
            // - ë°˜ì§ì„ ì†ë„: 0.008 ~ 0.023 (ì¤‘ê°„)

            for (let i = 0; i < 100; i++) {
                stars.push({
                    x: Math.random(),
                    y: Math.random(),
                    size: Math.random() * 1.5 + 0.8,
                    opacity: Math.random(),
                    twinkleSpeed: Math.random() * 0.015 + 0.008,
                    layer: 2,
                    color: starColors[Math.floor(Math.random() * starColors.length)],
                    pulsePhase: Math.random() * Math.PI * 2
                })
            }

            // ==========================================
            // Layer 3: ì‘ì€ ë³„ (200ê°œ)
            // ==========================================
            // 
            // ğŸ¨ íŠ¹ì§•:
            // - í¬ê¸°: 0.3 ~ 1.3px (ê°€ì¥ ì‘ìŒ)
            // - ë°˜ì§ì„ ì†ë„: 0.005 ~ 0.015 (ëŠë¦¼)
            // - íˆ¬ëª…ë„: 0 ~ 0.6 (ë” í¬ë¯¸í•¨)

            for (let i = 0; i < 200; i++) {
                stars.push({
                    x: Math.random(),
                    y: Math.random(),
                    size: Math.random() * 1 + 0.3,
                    opacity: Math.random() * 0.6,
                    twinkleSpeed: Math.random() * 0.01 + 0.005,
                    layer: 3,
                    color: starColors[Math.floor(Math.random() * starColors.length)],
                    pulsePhase: Math.random() * Math.PI * 2
                })
            }
        }

        // ë³„ ìƒì„± ì‹¤í–‰
        createStars()

        // ==========================================
        // [Shooting Stars] ìœ ì„± ìƒì„± ì‹œìŠ¤í…œ
        // ==========================================
        // 
        // ğŸ¯ ëª©ì : ëœë¤í•œ ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ìœ ì„±ì„ ìƒì„±í•˜ì—¬ ë™ì ì¸ ëŠë‚Œ ë¶€ì—¬
        // 
        // ğŸ’« ìƒì„± ì „ëµ:
        // - ê¸°ë³¸: 0.3~1.1ì´ˆë§ˆë‹¤ 1ê°œ ìƒì„±
        // - ì¶”ê°€: 50% í™•ë¥ ë¡œ 0.1ì´ˆ í›„ 1ê°œ ë” ìƒì„± (2ê°œ ë™ì‹œ)
        // - ì¶”ê°€: 20% í™•ë¥ ë¡œ 0.2ì´ˆ í›„ 1ê°œ ë” ìƒì„± (3ê°œ ë™ì‹œ)

        const shootingStars: ShootingStar[] = []

        /**
         * ğŸ’« ìœ ì„± ìƒì„± í•¨ìˆ˜
         * 
         * @description
         * í™”ë©´ ìƒë‹¨ì—ì„œ ëœë¤í•œ ìœ„ì¹˜ì— ìœ ì„±ì„ ìƒì„±í•©ë‹ˆë‹¤.
         * ê° ìœ ì„±ì€ ê³ ìœ í•œ ê¸¸ì´ì™€ ì†ë„ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
         */
        const createShootingStar = () => {
            shootingStars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height * 0.5, // í™”ë©´ ìƒë‹¨ 50% ì˜ì—­ì—ì„œë§Œ ìƒì„±
                length: Math.random() * 120 + 100, // ê¼¬ë¦¬ ê¸¸ì´: 100~220px
                speed: Math.random() * 4 + 3, // ì†ë„: 3~7 í”½ì…€/í”„ë ˆì„
                opacity: 1,
                angle: Math.PI / 4 // 45ë„ ê°ë„ë¡œ ì´ë™
            })
        }

        // ìœ ì„± ìƒì„± íƒ€ì´ë° ì œì–´ ë³€ìˆ˜
        // setIntervalì„ ì‚¬ìš©í•˜ë©´ íƒ­ ë¹„í™œì„±í™” ì‹œì—ë„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ì–´ 
        // íƒ­ ë³µê·€ ì‹œ ìœ ì„± í­íƒ„(Meteor Shower) í˜„ìƒì´ ë°œìƒí•©ë‹ˆë‹¤.
        // ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ animation loop ë‚´ì—ì„œ ì‹œê°„ì„ ì²´í¬í•˜ì—¬ ìƒì„±í•˜ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
        let lastShootingStarTime = 0
        let nextShootingStarInterval = Math.random() * 800 + 300

        // ==========================================
        // [Animation Loop] ë©”ì¸ ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        // ==========================================
        // 
        // ğŸ¬ ë Œë”ë§ ìˆœì„œ:
        // 1. ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ ê·¸ë¦¬ê¸°
        // 2. ì€í•˜ìˆ˜ ë¨¼ì§€ ê·¸ë¦¬ê¸° + ì—…ë°ì´íŠ¸
        // 3. ë³„ ê·¸ë¦¬ê¸° + ì—…ë°ì´íŠ¸
        // 4. ìœ ì„± ìƒì„± ë° ê·¸ë¦¬ê¸° + ì—…ë°ì´íŠ¸
        // 5. requestAnimationFrameìœ¼ë¡œ ë‹¤ìŒ í”„ë ˆì„ ì˜ˆì•½
        // 
        // ğŸ’¡ ì„±ëŠ¥ ìµœì í™”:
        // - requestAnimationFrame ì‚¬ìš© (ë¸Œë¼ìš°ì € ìµœì í™”)
        // - í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ê°ì²´ëŠ” ë°°ì—´ì—ì„œ ì œê±°

        let animationId: number

        /**
         * ğŸ¨ ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ í•¨ìˆ˜
         * 
         * @description
         * ë§¤ í”„ë ˆì„ë§ˆë‹¤ í˜¸ì¶œë˜ì–´ ìº”ë²„ìŠ¤ë¥¼ ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤.
         * 60fpsë¡œ ì‹¤í–‰ë˜ë©°, ëª¨ë“  ê°ì²´ì˜ ìœ„ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        const animate = (timestamp: number) => {
            // timestampê°€ ì—†ì„ ê²½ìš° (ìµœì´ˆ ì‹¤í–‰ ë“±) ë°©ì–´ ì½”ë“œ
            if (!timestamp) timestamp = performance.now()

            // ==========================================
            // [Background Gradient] ë°°ê²½ ê·¸ë¼ë°ì´ì…˜
            // ==========================================
            // 
            // ì§€ë¸Œë¦¬ ìŠ¤íƒ€ì¼ì˜ ë³´ë¼-í•‘í¬ ê·¸ë¼ë°ì´ì…˜
            // - ìƒë‹¨: #0a0e27 (ì§„í•œ ë‚¨ìƒ‰)
            // - ì¤‘ê°„: #1a1a3e (ë³´ë¼ìƒ‰)
            // - í•˜ë‹¨: #2d1b3d (ìì£¼ìƒ‰)

            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height)
            gradient.addColorStop(0, '#0a0e27')
            gradient.addColorStop(0.5, '#1a1a3e')
            gradient.addColorStop(1, '#2d1b3d')
            ctx.fillStyle = gradient
            ctx.fillRect(0, 0, canvas.width, canvas.height)

            // ==========================================
            // [Nebula Dust Rendering] ì€í•˜ìˆ˜ ë¨¼ì§€ ë Œë”ë§
            // ==========================================
            // 
            // ğŸ¨ ë Œë”ë§ ê³¼ì •:
            // 1. ê° íŒŒí‹°í´ì„ ì›(arc)ìœ¼ë¡œ ê·¸ë¦¬ê¸°
            // 2. í° íŒŒí‹°í´(size > 1.5)ì—ëŠ” ê¸€ë¡œìš° íš¨ê³¼ ì¶”ê°€
            // 3. ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (ì™¼ìª½ ìœ„ë¡œ ì´ë™)
            // 4. í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ë°˜ëŒ€í¸ì—ì„œ ë‹¤ì‹œ ë“±ì¥ (Wrapping)

            nebulaDust.forEach(dust => {
                // íŒŒí‹°í´ ìƒ‰ìƒ ë° íˆ¬ëª…ë„ ì„¤ì •
                ctx.fillStyle = dust.color
                ctx.globalAlpha = dust.opacity

                // ì› ê·¸ë¦¬ê¸° (arc: ì¤‘ì‹¬ x, y, ë°˜ì§€ë¦„, ì‹œì‘ê°, ëê°)
                ctx.beginPath()
                ctx.arc(dust.x, dust.y, dust.size, 0, Math.PI * 2)
                ctx.fill()

                // í° íŒŒí‹°í´ì—ë§Œ ê¸€ë¡œìš° íš¨ê³¼ ì ìš© (ì„±ëŠ¥ ìµœì í™”)
                if (dust.size > 1.5) {
                    ctx.shadowBlur = 12 // ë¸”ëŸ¬ ë°˜ê²½
                    ctx.shadowColor = dust.color
                    ctx.fill()
                    ctx.shadowBlur = 0 // ë‹¤ìŒ ê°ì²´ì— ì˜í–¥ ì£¼ì§€ ì•Šë„ë¡ ì´ˆê¸°í™”
                }

                // íˆ¬ëª…ë„ ì´ˆê¸°í™” (ë‹¤ìŒ ê°ì²´ì— ì˜í–¥ ì£¼ì§€ ì•Šë„ë¡)
                ctx.globalAlpha = 1

                // ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (ì™¼ìª½ ìœ„ë¡œ ì²œì²œíˆ ì´ë™)
                dust.x += dust.speedX
                dust.y += dust.speedY

                // Wrapping: í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ë°˜ëŒ€í¸ì—ì„œ ë“±ì¥
                if (dust.x < 0) dust.x = canvas.width
                if (dust.x > canvas.width) dust.x = 0
                if (dust.y < 0) dust.y = canvas.height
                if (dust.y > canvas.height) dust.y = 0
            })

            // ==========================================
            // [Star Rendering] ë³„ ë Œë”ë§
            // ==========================================
            // 
            // ğŸ¨ ë Œë”ë§ ê³¼ì •:
            // 1. ë°˜ì§ì„ íš¨ê³¼ (opacity ì¦ê°)
            // 2. í„ìŠ¤ íš¨ê³¼ (í¬ê¸° ë³€í™”)
            // 3. ë³„ ê·¸ë¦¬ê¸°
            // 4. í° ë³„ì— ê¸€ë¡œìš° íš¨ê³¼
            // 5. ë ˆì´ì–´ë³„ ë‹¤ë¥¸ ì†ë„ë¡œ ì´ë™ (Parallax)

            stars.forEach(star => {
                // ==========================================
                // [Twinkle Effect] ë°˜ì§ì„ íš¨ê³¼
                // ==========================================
                // 
                // opacityë¥¼ ì¦ê°ì‹œì¼œ ë³„ì´ ê¹œë¹¡ì´ëŠ” íš¨ê³¼
                // 0.2 ~ 1.0 ë²”ìœ„ì—ì„œ ì§„ë™

                star.opacity += star.twinkleSpeed

                // ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë©´ ë°©í–¥ ë°˜ì „
                if (star.opacity > 1 || star.opacity < 0.2) {
                    star.twinkleSpeed *= -1
                }

                // ==========================================
                // [Pulse Effect] í„ìŠ¤ íš¨ê³¼
                // ==========================================
                // 
                // sin í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³„ì˜ í¬ê¸°ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ë³€í•¨
                // pulseFactor: 0.8 ~ 1.2 ë²”ìœ„ë¡œ ì§„ë™

                star.pulsePhase += 0.02
                const pulseFactor = 1 + Math.sin(star.pulsePhase) * 0.2

                // ìƒ‰ìƒ ë¬¸ìì—´ì—ì„œ íˆ¬ëª…ë„ë§Œ ë™ì ìœ¼ë¡œ ë³€ê²½
                // ì˜ˆ: 'rgba(255, 255, 255, 1)' -> 'rgba(255, 255, 255, 0.5)'
                const baseColor = star.color.replace('1)', `${star.opacity})`)

                // ==========================================
                // [Coordinate Conversion] ì¢Œí‘œ ë³€í™˜
                // ==========================================
                // 
                // ë¹„ìœ¨(0~1)ì„ ì‹¤ì œ í”½ì…€ë¡œ ë³€í™˜
                // ë¦¬ì‚¬ì´ì¦ˆ ì‹œì—ë„ ë³„ì˜ ìƒëŒ€ì  ìœ„ì¹˜ ìœ ì§€

                const actualX = star.x * canvas.width
                const actualY = star.y * canvas.height

                // ë³„ ê·¸ë¦¬ê¸°
                ctx.fillStyle = baseColor
                ctx.beginPath()
                ctx.arc(actualX, actualY, star.size * pulseFactor, 0, Math.PI * 2)
                ctx.fill()

                // ==========================================
                // [Glow Effect] ê¸€ë¡œìš° íš¨ê³¼ (í° ë³„ë§Œ)
                // ==========================================
                // 
                // Layer 1 ë³„ì´ ë°ì„ ë•Œ(opacity > 0.7)ë§Œ ì ìš©
                // ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì„ íƒì  ì ìš©

                if (star.layer === 1 && star.opacity > 0.7) {
                    ctx.shadowBlur = 15
                    ctx.shadowColor = baseColor
                    ctx.fill()
                    ctx.shadowBlur = 0
                }

                // ==========================================
                // [Parallax Movement] íŒ¨ëŸ´ë ‰ìŠ¤ ì´ë™
                // ==========================================
                // 
                // ë ˆì´ì–´ë³„ë¡œ ë‹¤ë¥¸ ì†ë„ë¡œ ì´ë™í•˜ì—¬ ê¹Šì´ê° í‘œí˜„
                // - Layer 1: 0.00005 (ë¹ ë¦„, ê°€ê¹Œì´ ìˆëŠ” ëŠë‚Œ)
                // - Layer 2: 0.00003 (ì¤‘ê°„)
                // - Layer 3: 0.00001 (ëŠë¦¼, ë©€ë¦¬ ìˆëŠ” ëŠë‚Œ)

                const moveSpeed = star.layer === 1 ? 0.00005 : star.layer === 2 ? 0.00003 : 0.00001
                star.x -= moveSpeed

                // Wrapping: ì™¼ìª½ìœ¼ë¡œ ë‚˜ê°€ë©´ ì˜¤ë¥¸ìª½ì—ì„œ ë“±ì¥
                if (star.x < -0.01) {
                    star.x = 1.01
                    star.y = Math.random() // Y ì¢Œí‘œëŠ” ëœë¤í•˜ê²Œ ì¬ë°°ì¹˜
                }
            })

            // ==========================================
            // [Shooting Star Generation] ìœ ì„± ìƒì„± (Frame Loop ê¸°ë°˜)
            // ==========================================
            // 
            // setInterval ëŒ€ì‹  í”„ë ˆì„ ë£¨í”„ ë‚´ì—ì„œ ì‹œê°„ì„ ì²´í¬í•˜ì—¬ ìƒì„±
            // ì¥ì : íƒ­ì´ ë¹„í™œì„±í™”ë˜ì–´ animateê°€ ë©ˆì¶”ë©´ ìœ ì„± ìƒì„±ë„ ìë™ìœ¼ë¡œ ë©ˆì¶¤ (ìœ ì„± í­íƒ„ ë°©ì§€)

            if (timestamp - lastShootingStarTime > nextShootingStarInterval) {
                createShootingStar()

                // í™•ë¥ ì ìœ¼ë¡œ ì¶”ê°€ ìƒì„± (ë‹¨ìˆœí™”: 2ê°œ ë™ì‹œ ìƒì„± í™•ë¥ )
                if (Math.random() > 0.5) {
                    createShootingStar()
                }

                lastShootingStarTime = timestamp
                nextShootingStarInterval = Math.random() * 800 + 300
            }

            // ==========================================
            // [Shooting Star Rendering] ìœ ì„± ë Œë”ë§
            // ==========================================
            // 
            // ğŸ¨ ë Œë”ë§ ê³¼ì •:
            // 1. ê·¸ë¼ë°ì´ì…˜ ê¼¬ë¦¬ ìƒì„± (ë¨¸ë¦¬ â†’ ê¼¬ë¦¬ë¡œ í˜ì´ë“œì•„ì›ƒ)
            // 2. ì„ (Line)ìœ¼ë¡œ ìœ ì„± ê·¸ë¦¬ê¸°
            // 3. ì‚¼ê°í•¨ìˆ˜ë¡œ ê°ë„ì— ë”°ë¼ ì´ë™
            // 4. íˆ¬ëª…ë„ ê°ì†Œ (ì‹œê°„ì´ ì§€ë‚˜ë©´ ì‚¬ë¼ì§)
            // 5. í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ê±°ë‚˜ íˆ¬ëª…í•´ì§€ë©´ ë°°ì—´ì—ì„œ ì œê±°

            shootingStars.forEach((star, index) => {
                // ==========================================
                // [Gradient Trail] ê·¸ë¼ë°ì´ì…˜ ê¼¬ë¦¬
                // ==========================================
                // 
                // LinearGradientë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ ì„±ì˜ ê¼¬ë¦¬ íš¨ê³¼ ìƒì„±
                // - ì‹œì‘ì  (ë¨¸ë¦¬): ë°ì€ í°ìƒ‰
                // - ì¤‘ê°„ì : íŒŒë€ë¹› (50% íˆ¬ëª…ë„)
                // - ëì  (ê¼¬ë¦¬): ì™„ì „ íˆ¬ëª…

                const gradient = ctx.createLinearGradient(
                    star.x, // ì‹œì‘ X (ìœ ì„± ë¨¸ë¦¬)
                    star.y, // ì‹œì‘ Y
                    star.x - Math.cos(star.angle) * star.length, // ë X (ìœ ì„± ê¼¬ë¦¬)
                    star.y - Math.sin(star.angle) * star.length  // ë Y
                )

                // ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ ì •ì˜
                gradient.addColorStop(0, `rgba(255, 255, 255, ${star.opacity})`) // ë¨¸ë¦¬: í°ìƒ‰
                gradient.addColorStop(0.5, `rgba(200, 220, 255, ${star.opacity * 0.5})`) // ì¤‘ê°„: íŒŒë€ë¹›
                gradient.addColorStop(1, 'rgba(200, 220, 255, 0)') // ê¼¬ë¦¬: íˆ¬ëª…

                // ==========================================
                // [Draw Line] ì„  ê·¸ë¦¬ê¸°
                // ==========================================
                // 
                // moveTo â†’ lineTo â†’ strokeë¡œ ìœ ì„±ì˜ ê¶¤ì ì„ ê·¸ë¦¼

                ctx.strokeStyle = gradient
                ctx.lineWidth = 3 // ì„  ë‘ê»˜ (ë” ë‘ê»ê²Œ í•˜ì—¬ ì‹œì¸ì„± í–¥ìƒ)
                ctx.beginPath()
                ctx.moveTo(star.x, star.y) // ì‹œì‘ì 
                ctx.lineTo(
                    star.x - Math.cos(star.angle) * star.length,
                    star.y - Math.sin(star.angle) * star.length
                ) // ëì 
                ctx.stroke()

                // ==========================================
                // [Movement] ì´ë™ (ì‚¼ê°í•¨ìˆ˜)
                // ==========================================
                // 
                // ê°ë„(angle)ì— ë”°ë¼ X, Y ë°©í–¥ìœ¼ë¡œ ì´ë™
                // - Math.cos(angle): Xì¶• ë°©í–¥ ì„±ë¶„
                // - Math.sin(angle): Yì¶• ë°©í–¥ ì„±ë¶„
                // - angle = Ï€/4 (45ë„) â†’ ì˜¤ë¥¸ìª½ ì•„ë˜ë¡œ ì´ë™

                star.x += Math.cos(star.angle) * star.speed
                star.y += Math.sin(star.angle) * star.speed

                // íˆ¬ëª…ë„ ê°ì†Œ (ì‹œê°„ì´ ì§€ë‚˜ë©´ ì„œì„œíˆ ì‚¬ë¼ì§)
                star.opacity -= 0.01

                // ==========================================
                // [Cleanup] ë©”ëª¨ë¦¬ ì •ë¦¬
                // ==========================================
                // 
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ê±°ë‚˜ ì™„ì „íˆ íˆ¬ëª…í•´ì§„ ìœ ì„±ì€ ë°°ì—´ì—ì„œ ì œê±°
                // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ ë° ì„±ëŠ¥ ìµœì í™”

                if (star.x > canvas.width || star.y > canvas.height || star.opacity <= 0) {
                    shootingStars.splice(index, 1)
                }
            })

            // ë‹¤ìŒ í”„ë ˆì„ ì˜ˆì•½ (60fps ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„)
            animationId = requestAnimationFrame(animate)
        }

        // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ (ì²« Frameì„ requestAnimationFrameìœ¼ë¡œ í˜¸ì¶œí•˜ì—¬ timestamp ì „ë‹¬)
        animationId = requestAnimationFrame(animate)

        // ==========================================
        // [Cleanup] ì •ë¦¬ í•¨ìˆ˜
        // ==========================================
        // 
        // ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë  ë•Œ ì‹¤í–‰ë˜ëŠ” ì •ë¦¬ í•¨ìˆ˜
        // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ë¥¼ ìœ„í•´ ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì™€ ì¸í„°ë²Œì„ ì œê±°í•©ë‹ˆë‹¤.

        return () => {
            // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
            window.removeEventListener('resize', resizeCanvas)

            // ì• ë‹ˆë©”ì´ì…˜ í”„ë ˆì„ ì·¨ì†Œ
            cancelAnimationFrame(animationId)
        }
    }, []) // ë¹ˆ ì˜ì¡´ì„± ë°°ì—´: ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ í•œ ë²ˆë§Œ ì‹¤í–‰

    return (
        <div className={styles.container}>
            <canvas ref={canvasRef} className={styles.canvas} />
        </div>
    )
}
